<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Perfume Calculator</title>
  <link rel="manifest" href="./manifest.json" />
  <meta name="theme-color" content="#ffffff" />
  <link rel="stylesheet" href="./styles.css?v=final-fix-1" />
  <script>
  (async () => {
    try {
      if ('serviceWorker' in navigator) {
        const regs = await navigator.serviceWorker.getRegistrations();
        for (const r of regs) { try { await r.unregister(); } catch (e) {} }
      }
      if (window.caches) {
        const keys = await caches.keys();
        await Promise.all(keys.map(k => caches.delete(k)));
      }
    } catch (e) {}
  })();
  </script>
</head>
<body>
  <header class="app-header">
    <h1>Perfume Calculator</h1>
    <nav class="modes">
      <button id="modeSimple" class="tab-btn" data-mode="simple">Simple</button>
      <button id="modePro" class="tab-btn" data-mode="pro">Pro</button>
    </nav>
    <div class="header-actions">
      <button id="themeToggle" class="secondary">ðŸŒ“ Theme</button>
    </div>
  </header>

  <div id="updateBanner" class="update-banner" hidden>
    <p>A new version is available! <button id="refreshBtn">Refresh</button></p>
  </div>

  <main>
    <section id="simpleSection" hidden>
      <h2>Simple Mode (Drops)</h2>
      <div class="row">
        <label>Total Drops in Blend:</label>
        <input type="number" id="simpleTotal" value="100" />
      </div>
      <div id="simpleRows">
        <div class="simple-row">
          <input type="text" class="simple-name" placeholder="Ingredient Name" />
          <input type="number" class="simple-drops" placeholder="Drops" />
          <span class="simple-pct">â€” %</span>
          <button class="simple-del secondary">Ã—</button>
        </div>
      </div>
      <button id="simpleAdd">+ Add</button>
    </section>

    <section id="proSection" hidden>
      <h2>Pro Mode (Weight & Cost)</h2>
      <div class="table-wrap">
        <table>
          <thead>
            <tr>
              <th>Material</th>
              <th>Vol (drop)</th>
              <th>d (g/mL)</th>
              <th>Weight (g)</th>
              <th>Cost (â‚¬/g)</th>
              <th>Cost (â‚¬)</th>
              <th>Conc. (%)</th>
              <th>Note</th>
              <th>Source</th>
              <th>IFRA (%)</th>
              <th>Status</th>
              <th>Del</th>
            </tr>
          </thead>
          <tbody id="proBody"></tbody>
          <tfoot>
            <tr>
              <td><strong>Totals</strong></td>
              <td id="proTotalVol"></td>
              <td>-</td>
              <td id="proTotalWt"></td>
              <td>-</td>
              <td id="proTotalCost"></td>
              <td id="proTotalPct">100.00 %</td>
              <td colspan="5"></td>
            </tr>
          </tfoot>
        </table>
      </div>

      <button id="proAdd">+ Add Ingredient</button>
      <button id="proSave" class="secondary">ðŸ’¾ Save Formula</button>
      <button id="proLoad" class="secondary">ðŸ“‚ Load Formula</button>

      <div class="cards">
        <div id="noteSummary" class="card">
          <h4>Note Balance</h4>
          <div id="noteSummaryText">â€”</div>
        </div>
        <div id="ifraStatus" class="card">
          <h4>IFRA Compliance</h4>
          <div id="ifraStatusText">Enter rows to evaluate.</div>
        </div>
        <div id="priceHelper" class="card">
          <h4>Price per 10g</h4>
          <div class="row">
            <label>Total Cost (â‚¬)</label>
            <input type="number" id="helperCost" />
            <label>Total Weight (g)</label>
            <input type="number" id="helperWeight" />
            <strong>Result: <span id="helperResult">â‚¬0.00 per 10g</span></strong>
          </div>
        </div>
      </div>
    </section>

    <datalist id="ingredientList"></datalist>
  </main>

  <footer class="app-footer">
    <small>PWA demo â€¢ replace data/ files for production</small>
  </footer>

  <script defer src="./app.js?v=save-load-1"></script>
</body>
</html>
