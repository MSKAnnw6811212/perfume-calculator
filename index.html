<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Perfume Calculator</title>
  <link rel="manifest" href="./manifest.json">
  <meta name="theme-color" content="#ffffff">
  <!-- Critical: use RELATIVE paths (no leading slash) -->
  <link rel="stylesheet" href="./styles.css">
</head>
<body>
  <header class="app-header">
    <h1>Perfume Calculator</h1>
    <nav class="modes">
      <button id="modeSimple" class="tab-btn" data-mode="simple">Simple</button>
      <button id="modePro" class="tab-btn" data-mode="pro">Pro</button>
    </nav>
    <div class="header-actions">
      <button id="themeToggle">ðŸŒ“ Theme</button>
      <button id="installBtn" class="secondary" hidden>Install</button>
    </div>
  </header>

  <div id="updateBanner" class="update-banner" hidden>
    <span>Update available</span>
    <button id="refreshBtn">Refresh</button>
  </div>

  <main>
    <section id="simpleSection" class="panel" hidden>
      <h2>Simple</h2>
      <div class="row">
        <label>Dosage in finished product (%)</label>
        <input type="number" id="dosage" min="0" max="100" step="0.1" value="20">
      </div>

      <div class="row wrap">
        <button id="addRow">+ Add ingredient</button>
        <input type="text" id="recipeName" placeholder="Recipe name">
        <button id="saveRecipe">Save</button>
        <select id="savedRecipes"></select>
        <button id="loadRecipe" class="secondary">Load</button>
        <button id="deleteRecipe" class="danger">Delete</button>
        <button id="exportCsv" class="secondary">Export CSV</button>
        <button id="printBtn" class="secondary">Print</button>
        <button id="clearAll" class="danger">Clear</button>
      </div>

      <section class="card batch-helper">
        <div class="row wrap">
          <strong>Batch scaling helper</strong>
          <label>Target finished volume (ml)</label>
          <input type="number" id="batchVolume" value="1000">
          <label>Assumed concentrate density (g/ml)</label>
          <input type="number" id="batchDensity" value="0.85" step="0.01">
          <button id="batchCalcBtn" class="secondary">Calculate</button>
          <button id="batchExportBtn" class="secondary">Export Batch CSV</button>
        </div>
        <div class="table-wrap">
          <table id="batchTable">
            <thead><tr><th>Ingredient</th><th>% in concentrate</th><th>Oil volume (ml)</th><th>Weight (g)</th></tr></thead>
            <tbody id="batchBody"></tbody>
            <tfoot><tr><td><strong>Totals</strong></td><td id="batchPctTotal"></td><td id="batchVolTotal"></td><td id="batchWtTotal"></td></tr></tfoot>
          </table>
        </div>
      </section>

      <div class="row"><small id="dataStatus">Loading dataâ€¦</small></div>

      <section class="table-wrap">
        <table id="ingredientsTable">
          <thead>
            <tr>
              <th>#</th><th>Ingredient</th><th>% in concentrate</th><th>Finished %</th>
              <th>IFRA 4</th><th>IFRA 5A</th><th>IFRA 5B</th><th>IFRA 9</th><th>Actions</th>
            </tr>
          </thead>
          <tbody id="tableBody"></tbody>
          <tfoot>
            <tr><td colspan="2">Totals</td><td id="totalConcentrate">0</td><td id="totalFinished">0</td><td colspan="4"></td><td></td></tr>
          </tfoot>
        </table>
      </section>
    </section>

    <section id="proSection" class="panel" hidden>
      <h2>Pro</h2>
      <div class="row wrap">
        <label>Target Volume (ml)</label><input type="number" id="targetVolume" value="100">
        <label>IFRA Category</label>
        <select id="ifraCategory">
          <option value="4">4 â€“ Fine Fragrance</option>
          <option value="5A">5A â€“ Body Lotion</option>
          <option value="5B">5B â€“ Face Cream</option>
          <option value="9">9 â€“ Soap</option>
        </select>
        <button id="proSave">Save</button><select id="proSaved"></select>
        <button id="proLoad" class="secondary">Load</button><button id="proDelete" class="danger">Delete</button>
        <button id="proNew" class="secondary">New</button><button id="proExport" class="secondary">Export CSV</button>
        <button id="proPrint" class="secondary">Print</button>
      </div>

      <div class="table-wrap">
        <table id="proTable">
          <thead>
            <tr>
              <th>Ingredient</th><th>Volume (ml)</th><th>Density (g/ml)</th><th>Weight (g)</th><th>Price/10g (â‚¬)</th><th>Cost (â‚¬)</th><th>Formula %</th><th>Note</th><th>Supplier</th><th>CAS</th><th>Notes</th><th>Del</th>
            </tr>
          </thead>
          <tbody id="proBody"></tbody>
          <tfoot>
            <tr><td><strong>Totals</strong></td><td id="proTotalVol"></td><td>-</td><td id="proTotalWt"></td><td>-</td><td id="proTotalCost"></td><td id="proTotalPct">100.00 %</td><td colspan="5"></td></tr>
          </tfoot>
        </table>
      </div>

      <button id="proAdd">+ Add Ingredient</button>

      <div class="cards">
        <div id="noteSummary" class="card"><h4>Note Balance</h4><div id="noteSummaryText">â€”</div></div>
        <div id="ifraStatus" class="card"><h4>IFRA Compliance</h4><div id="ifraStatusText">Enter rows to evaluate.</div></div>
        <div id="priceHelper" class="card"><h4>Price per 10g</h4><div class="row"><label>Total Cost (â‚¬)</label><input type="number" id="helperCost"><label>Total Weight (g)</label><input type="number" id="helperWeight"><strong>Result: <span id="helperResult">â‚¬0.00 per 10g</span></strong></div></div>
      </div>
    </section>

    <datalist id="ingredientList"></datalist>
  </main>

  <footer class="app-footer"><small>PWA demo â€¢ replace data/ files for production</small></footer>
  <!-- Critical: relative path -->
  <script src="./app.js"></script>
</body>
</html>
